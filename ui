-- Neverlose UI Library for Roblox
-- Author: Custom
-- Version: 2.0.0

local Players = game:GetService("Players")
local TweenService = game:GetService("TweenService")
local UserInputService = game:GetService("UserInputService")
local RunService = game:GetService("RunService")

local LocalPlayer = Players.LocalPlayer
local PlayerGui = LocalPlayer:WaitForChild("PlayerGui")

local NeverloseUI = {}
NeverloseUI.__index = NeverloseUI

-- Neverlose Color Scheme
local Colors = {
    Background = Color3.fromRGB(18, 18, 23),
    Secondary = Color3.fromRGB(24, 24, 30),
    Tertiary = Color3.fromRGB(30, 30, 38),
    Border = Color3.fromRGB(45, 45, 55),
    Text = Color3.fromRGB(255, 255, 255),
    TextSecondary = Color3.fromRGB(180, 180, 190),
    TextDisabled = Color3.fromRGB(100, 100, 110),
    Accent = Color3.fromRGB(138, 43, 226), -- Purple
    AccentHover = Color3.fromRGB(155, 60, 245),
    AccentActive = Color3.fromRGB(120, 30, 200),
    Success = Color3.fromRGB(0, 255, 100),
    Error = Color3.fromRGB(255, 80, 80),
}

-- Utility functions
local function Create(class, props)
    local instance = Instance.new(class)
    for prop, value in pairs(props or {}) do
        if prop ~= "Parent" and prop ~= "Children" then
            if pcall(function() return instance[prop] end) then
                instance[prop] = value
            end
        end
    end
    if props and props.Parent then
        instance.Parent = props.Parent
    end
    if props and props.Children then
        for _, child in ipairs(props.Children) do
            child.Parent = instance
        end
    end
    return instance
end

local function Tween(obj, props, duration, style, direction)
    local tweenInfo = TweenInfo.new(
        duration or 0.2,
        style or Enum.EasingStyle.Quad,
        direction or Enum.EasingDirection.Out
    )
    local tween = TweenService:Create(obj, tweenInfo, props)
    tween:Play()
    return tween
end

local function ApplyCornerRadius(obj, radius)
    local corner = Instance.new("UICorner")
    corner.CornerRadius = UDim.new(0, radius or 4)
    corner.Parent = obj
    return corner
end

local function CreateStroke(obj, color, thickness, transparency)
    local stroke = Instance.new("UIStroke")
    stroke.Color = color or Colors.Border
    stroke.Thickness = thickness or 1
    stroke.Transparency = transparency or 0.7
    stroke.Parent = obj
    return stroke
end

-- Window
function NeverloseUI:Window(title, subtitle, toggleKey)
    title = title or "Neverlose"
    subtitle = subtitle or "Roblox"
    toggleKey = toggleKey or Enum.KeyCode.Insert
    
    local window = {}
    window._elements = {}
    window._sections = {}
    window._visible = true
    window._toggleKey = toggleKey
    window._currentSection = nil
    
    -- Main ScreenGui
    local screenGui = Create("ScreenGui", {
        Name = title .. "_UI",
        ZIndexBehavior = Enum.ZIndexBehavior.Sibling,
        ResetOnSpawn = false,
        DisplayOrder = 100,
        Parent = PlayerGui,
    })
    
    -- Main container
    local mainContainer = Create("Frame", {
        Name = "MainContainer",
        Size = UDim2.new(0, 1200, 0, 700),
        Position = UDim2.new(0.5, -600, 0.5, -350),
        BackgroundColor3 = Colors.Background,
        BorderSizePixel = 0,
        ZIndex = 1,
        Parent = screenGui,
    })
    ApplyCornerRadius(mainContainer, 8)
    CreateStroke(mainContainer, Colors.Border, 1, 0.5)
    
    -- Top bar
    local topBar = Create("Frame", {
        Name = "TopBar",
        Size = UDim2.new(1, 0, 0, 50),
        Position = UDim2.new(0, 0, 0, 0),
        BackgroundColor3 = Colors.Secondary,
        BorderSizePixel = 0,
        ZIndex = 10,
        Parent = mainContainer,
    })
    ApplyCornerRadius(topBar, 8, 8, 0, 0)
    
    -- Logo and title
    local logoContainer = Create("Frame", {
        Name = "LogoContainer",
        Size = UDim2.new(0, 180, 1, 0),
        Position = UDim2.new(0, 15, 0, 0),
        BackgroundTransparency = 1,
        Parent = topBar,
    })
    
    local logo = Create("TextLabel", {
        Name = "Logo",
        Size = UDim2.new(0, 30, 0, 30),
        Position = UDim2.new(0, 0, 0.5, -15),
        BackgroundColor3 = Colors.Accent,
        Text = "NL",
        TextColor3 = Colors.Text,
        TextSize = 16,
        Font = Enum.Font.GothamBold,
        BorderSizePixel = 0,
        Parent = logoContainer,
    })
    ApplyCornerRadius(logo, 4)
    
    local titleLabel = Create("TextLabel", {
        Name = "Title",
        Size = UDim2.new(0, 140, 0, 20),
        Position = UDim2.new(0, 38, 0, 8),
        BackgroundTransparency = 1,
        Text = title,
        TextColor3 = Colors.Text,
        TextSize = 16,
        Font = Enum.Font.GothamBold,
        TextXAlignment = Enum.TextXAlignment.Left,
        Parent = logoContainer,
    })
    
    local subtitleLabel = Create("TextLabel", {
        Name = "Subtitle",
        Size = UDim2.new(0, 140, 0, 16),
        Position = UDim2.new(0, 38, 0, 24),
        BackgroundTransparency = 1,
        Text = subtitle,
        TextColor3 = Colors.TextSecondary,
        TextSize = 12,
        Font = Enum.Font.Gotham,
        TextXAlignment = Enum.TextXAlignment.Left,
        Parent = logoContainer,
    })
    
    -- Top bar buttons (center)
    local topBarButtons = Create("Frame", {
        Name = "TopBarButtons",
        Size = UDim2.new(0, 300, 1, 0),
        Position = UDim2.new(0.5, -150, 0, 0),
        BackgroundTransparency = 1,
        Parent = topBar,
    })
    
    local folderBtn = Create("TextButton", {
        Name = "Folder",
        Size = UDim2.new(0, 40, 0, 40),
        Position = UDim2.new(0, 0, 0.5, -20),
        BackgroundColor3 = Colors.Tertiary,
        Text = "ðŸ“",
        TextColor3 = Colors.Text,
        TextSize = 18,
        Font = Enum.Font.Gotham,
        BorderSizePixel = 0,
        Parent = topBarButtons,
    })
    ApplyCornerRadius(folderBtn, 4)
    
    -- Search button (right)
    local searchBtn = Create("TextButton", {
        Name = "Search",
        Size = UDim2.new(0, 40, 0, 40),
        Position = UDim2.new(1, -50, 0.5, -20),
        BackgroundColor3 = Colors.Tertiary,
        Text = "ðŸ”",
        TextColor3 = Colors.Text,
        TextSize = 18,
        Font = Enum.Font.Gotham,
        BorderSizePixel = 0,
        Parent = topBar,
    })
    ApplyCornerRadius(searchBtn, 4)
    
    -- Left sidebar
    local sidebar = Create("Frame", {
        Name = "Sidebar",
        Size = UDim2.new(0, 200, 1, -50),
        Position = UDim2.new(0, 0, 0, 50),
        BackgroundColor3 = Colors.Secondary,
        BorderSizePixel = 0,
        ZIndex = 5,
        Parent = mainContainer,
    })
    
    local sidebarLayout = Create("UIListLayout", {
        FillDirection = Enum.FillDirection.Vertical,
        Padding = UDim.new(0, 5),
        SortOrder = Enum.SortOrder.LayoutOrder,
        Parent = sidebar,
    })
    
    local sidebarPadding = Create("UIPadding", {
        PaddingTop = UDim.new(0, 15),
        PaddingBottom = UDim.new(0, 15),
        PaddingLeft = UDim.new(0, 10),
        PaddingRight = UDim.new(0, 10),
        Parent = sidebar,
    })
    
    -- Sidebar sections container
    local sidebarSections = Create("Frame", {
        Name = "Sections",
        Size = UDim2.new(1, 0, 1, -120),
        BackgroundTransparency = 1,
        LayoutOrder = 1,
        Parent = sidebar,
    })
    
    local sectionsLayout = Create("UIListLayout", {
        FillDirection = Enum.FillDirection.Vertical,
        Padding = UDim.new(0, 10),
        SortOrder = Enum.SortOrder.LayoutOrder,
        Parent = sidebarSections,
    })
    
    -- User profile at bottom
    local userProfile = Create("Frame", {
        Name = "UserProfile",
        Size = UDim2.new(1, -20, 0, 80),
        Position = UDim2.new(0, 10, 1, -100),
        BackgroundColor3 = Colors.Tertiary,
        BorderSizePixel = 0,
        LayoutOrder = 2,
        Parent = sidebar,
    })
    ApplyCornerRadius(userProfile, 6)
    CreateStroke(userProfile, Colors.Border, 1, 0.8)
    
    -- Main content area
    local contentArea = Create("Frame", {
        Name = "ContentArea",
        Size = UDim2.new(1, -200, 1, -50),
        Position = UDim2.new(0, 200, 0, 50),
        BackgroundColor3 = Colors.Background,
        BorderSizePixel = 0,
        ClipsDescendants = true,
        ZIndex = 2,
        Parent = mainContainer,
    })
    
    -- Two column layout
    local columnContainer = Create("Frame", {
        Name = "Columns",
        Size = UDim2.new(1, -30, 1, -30),
        Position = UDim2.new(0, 15, 0, 15),
        BackgroundTransparency = 1,
        Parent = contentArea,
    })
    
    local columnsLayout = Create("UIGridLayout", {
        CellSize = UDim2.new(0, 480, 1, 0),
        CellPadding = UDim2.new(0, 15, 0, 0),
        FillDirection = Enum.FillDirection.Horizontal,
        HorizontalAlignment = Enum.HorizontalAlignment.Left,
        SortOrder = Enum.SortOrder.LayoutOrder,
        Parent = columnContainer,
    })
    
    -- Left column
    local leftColumn = Create("ScrollingFrame", {
        Name = "LeftColumn",
        Size = UDim2.new(0, 480, 1, 0),
        Position = UDim2.new(0, 0, 0, 0),
        BackgroundTransparency = 1,
        BorderSizePixel = 0,
        ScrollBarThickness = 4,
        ScrollBarImageColor3 = Colors.Accent,
        CanvasSize = UDim2.new(0, 0, 0, 0),
        LayoutOrder = 1,
        Parent = columnContainer,
    })
    
    local leftColumnLayout = Create("UIListLayout", {
        FillDirection = Enum.FillDirection.Vertical,
        Padding = UDim.new(0, 15),
        SortOrder = Enum.SortOrder.LayoutOrder,
        Parent = leftColumn,
    })
    
    local leftColumnPadding = Create("UIPadding", {
        PaddingTop = UDim.new(0, 10),
        PaddingBottom = UDim.new(0, 10),
        Parent = leftColumn,
    })
    
    -- Right column
    local rightColumn = Create("ScrollingFrame", {
        Name = "RightColumn",
        Size = UDim2.new(0, 480, 1, 0),
        Position = UDim2.new(0, 495, 0, 0),
        BackgroundTransparency = 1,
        BorderSizePixel = 0,
        ScrollBarThickness = 4,
        ScrollBarImageColor3 = Colors.Accent,
        CanvasSize = UDim2.new(0, 0, 0, 0),
        LayoutOrder = 2,
        Parent = columnContainer,
    })
    
    local rightColumnLayout = Create("UIListLayout", {
        FillDirection = Enum.FillDirection.Vertical,
        Padding = UDim.new(0, 15),
        SortOrder = Enum.SortOrder.LayoutOrder,
        Parent = rightColumn,
    })
    
    local rightColumnPadding = Create("UIPadding", {
        PaddingTop = UDim.new(0, 10),
        PaddingBottom = UDim.new(0, 10),
        Parent = rightColumn,
    })
    
    -- Update canvas sizes
    local function updateCanvasSizes()
        local leftSize = leftColumnLayout.AbsoluteContentSize.Y
        local rightSize = rightColumnLayout.AbsoluteContentSize.Y
        leftColumn.CanvasSize = UDim2.new(0, 0, 0, math.max(leftSize, 600))
        rightColumn.CanvasSize = UDim2.new(0, 0, 0, math.max(rightSize, 600))
    end
    
    RunService.RenderStepped:Connect(updateCanvasSizes)
    
    -- Toggle visibility
    function window:Toggle()
        window._visible = not window._visible
        screenGui.Enabled = window._visible
    end
    
    function window:Show()
        window._visible = true
        screenGui.Enabled = true
    end
    
    function window:Hide()
        window._visible = false
        screenGui.Enabled = false
    end
    
    -- Bind toggle key
    UserInputService.InputBegan:Connect(function(input, gameProcessed)
        if gameProcessed then return end
        if input.KeyCode == window._toggleKey then
            window:Toggle()
        end
    end)
    
    -- Section creation
    function window:Section(name, icon, locked)
        locked = locked or false
        
        local section = {}
        section._name = name
        section._items = {}
        
        -- Section header in sidebar
        local sectionHeader = Create("TextButton", {
            Name = name .. "_Header",
            Size = UDim2.new(1, 0, 0, 30),
            BackgroundTransparency = 1,
            Text = name,
            TextColor3 = Colors.TextSecondary,
            TextSize = 11,
            Font = Enum.Font.GothamBold,
            TextXAlignment = Enum.TextXAlignment.Left,
            LayoutOrder = #window._sections + 1,
            Parent = sidebarSections,
        })
        
        local sectionItemsContainer = Create("Frame", {
            Name = name .. "_Items",
            Size = UDim2.new(1, 0, 0, 0),
            BackgroundTransparency = 1,
            Visible = false,
            Parent = sidebarSections,
        })
        
        local sectionItemsLayout = Create("UIListLayout", {
            FillDirection = Enum.FillDirection.Vertical,
            Padding = UDim.new(0, 3),
            SortOrder = Enum.SortOrder.LayoutOrder,
            Parent = sectionItemsContainer,
        })
        
        -- Section content (hidden initially)
        local sectionContent = Create("Frame", {
            Name = name .. "_Content",
            Size = UDim2.new(1, 0, 1, 0),
            Position = UDim2.new(0, 0, 0, 0),
            BackgroundTransparency = 1,
            Visible = #window._sections == 0,
            Parent = contentArea,
        })
        
        -- Update section items container size
        RunService.RenderStepped:Connect(function()
            if sectionItemsContainer.Parent then
                sectionItemsContainer.Size = UDim2.new(1, 0, 0, sectionItemsLayout.AbsoluteContentSize.Y)
            end
        end)
        
        -- Section toggle
        sectionHeader.MouseButton1Click:Connect(function()
            if locked then return end
            
            for _, otherSection in ipairs(window._sections) do
                if otherSection._content then
                    otherSection._content.Visible = false
                end
                if otherSection._itemsContainer then
                    otherSection._itemsContainer.Visible = false
                end
                if otherSection._header then
                    otherSection._header.TextColor3 = Colors.TextSecondary
                end
            end
            
            sectionContent.Visible = true
            sectionItemsContainer.Visible = true
            sectionHeader.TextColor3 = Colors.Accent
            window._currentSection = section
        end)
        
        if #window._sections == 0 then
            sectionHeader.TextColor3 = Colors.Accent
            sectionItemsContainer.Visible = true
        end
        
        section._header = sectionHeader
        section._content = sectionContent
        section._itemsContainer = sectionItemsContainer
        section._itemsLayout = sectionItemsLayout
        
        -- Item creation
        function section:Item(name, icon, callback)
            local item = Create("TextButton", {
                Name = name,
                Size = UDim2.new(1, -10, 0, 35),
                Position = UDim2.new(0, 5, 0, 0),
                BackgroundColor3 = Colors.Tertiary,
                Text = (icon or "â€¢") .. " " .. name,
                TextColor3 = Colors.Text,
                TextSize = 13,
                Font = Enum.Font.Gotham,
                TextXAlignment = Enum.TextXAlignment.Left,
                BorderSizePixel = 0,
                LayoutOrder = #section._items + 1,
                Parent = section._itemsContainer,
            })
            ApplyCornerRadius(item, 4)
            
            local itemPadding = Create("UIPadding", {
                PaddingLeft = UDim.new(0, 12),
                PaddingRight = UDim.new(0, 12),
                Parent = item,
            })
            
            local itemSelected = false
            
            item.MouseButton1Click:Connect(function()
                itemSelected = not itemSelected
                
                if itemSelected then
                    Tween(item, {BackgroundColor3 = Colors.Accent})
                    if callback then callback(true) end
                else
                    Tween(item, {BackgroundColor3 = Colors.Tertiary})
                    if callback then callback(false) end
                end
            end)
            
            item.MouseEnter:Connect(function()
                if not itemSelected then
                    Tween(item, {BackgroundColor3 = Colors.Border})
                end
            end)
            
            item.MouseLeave:Connect(function()
                if not itemSelected then
                    Tween(item, {BackgroundColor3 = Colors.Tertiary})
                end
            end)
            
            table.insert(section._items, item)
            
            local itemObj = {}
            function itemObj:SetActive(active)
                itemSelected = active
                item.BackgroundColor3 = active and Colors.Accent or Colors.Tertiary
            end
            
            return itemObj
        end
        
        -- Groupbox creation
        function section:Groupbox(name, column)
            column = column or "left" -- "left" or "right"
            
            local groupbox = {}
            groupbox._elements = {}
            
            local targetColumn = column == "left" and leftColumn or rightColumn
            
            local groupFrame = Create("Frame", {
                Name = name,
                Size = UDim2.new(1, 0, 0, 50),
                BackgroundColor3 = Colors.Secondary,
                BorderSizePixel = 0,
                LayoutOrder = #groupbox._elements + 1,
                Parent = targetColumn,
            })
            ApplyCornerRadius(groupFrame, 6)
            CreateStroke(groupFrame, Colors.Border, 1, 0.8)
            
            local titleFrame = Create("Frame", {
                Name = "Title",
                Size = UDim2.new(1, -20, 0, 35),
                Position = UDim2.new(0, 10, 0, 10),
                BackgroundTransparency = 1,
                Parent = groupFrame,
            })
            
            local titleLabel = Create("TextLabel", {
                Name = "Label",
                Size = UDim2.new(1, 0, 1, 0),
                Position = UDim2.new(0, 0, 0, 0),
                BackgroundTransparency = 1,
                Text = name,
                TextColor3 = Colors.Text,
                TextSize = 13,
                Font = Enum.Font.GothamBold,
                TextXAlignment = Enum.TextXAlignment.Left,
                Parent = titleFrame,
            })
            
            local contentContainer = Create("Frame", {
                Name = "Content",
                Size = UDim2.new(1, -20, 0, 0),
                Position = UDim2.new(0, 10, 0, 50),
                BackgroundTransparency = 1,
                Parent = groupFrame,
            })
            
            local contentLayout = Create("UIListLayout", {
                FillDirection = Enum.FillDirection.Vertical,
                Padding = UDim.new(0, 8),
                SortOrder = Enum.SortOrder.LayoutOrder,
                Parent = contentContainer,
            })
            
            local contentPadding = Create("UIPadding", {
                PaddingTop = UDim.new(0, 5),
                PaddingBottom = UDim.new(0, 10),
                Parent = contentContainer,
            })
            
            -- Update groupbox size
            RunService.RenderStepped:Connect(function()
                if groupFrame.Parent then
                    local contentSize = contentLayout.AbsoluteContentSize.Y
                    if contentSize > 0 then
                        groupFrame.Size = UDim2.new(1, 0, 0, contentSize + 60)
                    end
                end
            end)
            
            groupbox._frame = groupFrame
            groupbox._content = contentContainer
            
            -- Add Toggle
            function groupbox:AddToggle(text, options)
                options = options or {}
                local default = options.Default or false
                local callback = options.Callback
                local showEllipsis = options.ShowEllipsis or false
                
                local toggleFrame = Create("Frame", {
                    Name = "Toggle",
                    Size = UDim2.new(1, 0, 0, 35),
                    BackgroundTransparency = 1,
                    LayoutOrder = #groupbox._elements + 1,
                    Parent = contentContainer,
                })
                
                local toggleLabel = Create("TextLabel", {
                    Name = "Label",
                    Size = UDim2.new(1, -60, 1, 0),
                    Position = UDim2.new(0, 0, 0, 0),
                    BackgroundTransparency = 1,
                    Text = text,
                    TextColor3 = Colors.Text,
                    TextSize = 13,
                    Font = Enum.Font.Gotham,
                    TextXAlignment = Enum.TextXAlignment.Left,
                    Parent = toggleFrame,
                })
                
                if showEllipsis then
                    local ellipsis = Create("TextButton", {
                        Name = "Ellipsis",
                        Size = UDim2.new(0, 20, 0, 20),
                        Position = UDim2.new(0, -25, 0.5, -10),
                        BackgroundTransparency = 1,
                        Text = "...",
                        TextColor3 = Colors.TextSecondary,
                        TextSize = 14,
                        Font = Enum.Font.GothamBold,
                        Parent = toggleLabel,
                    })
                end
                
                local toggleBg = Create("Frame", {
                    Name = "Background",
                    Size = UDim2.new(0, 40, 0, 22),
                    Position = UDim2.new(1, -40, 0.5, -11),
                    BackgroundColor3 = default and Colors.Accent or Colors.Border,
                    BorderSizePixel = 0,
                    Parent = toggleFrame,
                })
                ApplyCornerRadius(toggleBg, 11)
                
                local toggleSlider = Create("Frame", {
                    Name = "Slider",
                    Size = UDim2.new(0, 18, 0, 18),
                    Position = UDim2.new(default and 1 or 0, default and -19 or 2, 0.5, -9),
                    BackgroundColor3 = Colors.Text,
                    BorderSizePixel = 0,
                    ZIndex = 5,
                    Parent = toggleBg,
                })
                ApplyCornerRadius(toggleSlider, 9)
                
                local state = default
                
                local function updateToggle()
                    if state then
                        Tween(toggleSlider, {Position = UDim2.new(1, -19, 0.5, -9)})
                        Tween(toggleBg, {BackgroundColor3 = Colors.Accent})
                    else
                        Tween(toggleSlider, {Position = UDim2.new(0, 2, 0.5, -9)})
                        Tween(toggleBg, {BackgroundColor3 = Colors.Border})
                    end
                    if callback then callback(state) end
                end
                
                toggleFrame.MouseButton1Click:Connect(function()
                    state = not state
                    updateToggle()
                end)
                
                table.insert(groupbox._elements, toggleFrame)
                
                local toggleObj = {}
                function toggleObj:SetValue(value)
                    state = value
                    updateToggle()
                end
                function toggleObj:GetValue()
                    return state
                end
                
                return toggleObj
            end
            
            -- Add Slider
            function groupbox:AddSlider(text, options)
                options = options or {}
                local min = options.Min or 0
                local max = options.Max or 100
                local default = options.Default or min
                local precise = options.Precise or 0
                local callback = options.Callback
                local showEllipsis = options.ShowEllipsis or false
                local suffix = options.Suffix or ""
                
                local sliderFrame = Create("Frame", {
                    Name = "Slider",
                    Size = UDim2.new(1, 0, 0, 45),
                    BackgroundTransparency = 1,
                    LayoutOrder = #groupbox._elements + 1,
                    Parent = contentContainer,
                })
                
                local sliderLabel = Create("TextLabel", {
                    Name = "Label",
                    Size = UDim2.new(1, -100, 0, 20),
                    Position = UDim2.new(0, 0, 0, 0),
                    BackgroundTransparency = 1,
                    Text = text,
                    TextColor3 = Colors.Text,
                    TextSize = 13,
                    Font = Enum.Font.Gotham,
                    TextXAlignment = Enum.TextXAlignment.Left,
                    Parent = sliderFrame,
                })
                
                if showEllipsis then
                    local ellipsis = Create("TextButton", {
                        Name = "Ellipsis",
                        Size = UDim2.new(0, 20, 0, 20),
                        Position = UDim2.new(0, -25, 0, 0),
                        BackgroundTransparency = 1,
                        Text = "...",
                        TextColor3 = Colors.TextSecondary,
                        TextSize = 14,
                        Font = Enum.Font.GothamBold,
                        Parent = sliderLabel,
                    })
                end
                
                local valueLabel = Create("TextLabel", {
                    Name = "Value",
                    Size = UDim2.new(0, 90, 0, 20),
                    Position = UDim2.new(1, -90, 0, 0),
                    BackgroundTransparency = 1,
                    Text = tostring(default) .. suffix,
                    TextColor3 = Colors.TextSecondary,
                    TextSize = 13,
                    Font = Enum.Font.Gotham,
                    TextXAlignment = Enum.TextXAlignment.Right,
                    Parent = sliderFrame,
                })
                
                local sliderBg = Create("Frame", {
                    Name = "Background",
                    Size = UDim2.new(1, 0, 0, 6),
                    Position = UDim2.new(0, 0, 0, 25),
                    BackgroundColor3 = Colors.Border,
                    BorderSizePixel = 0,
                    Parent = sliderFrame,
                })
                ApplyCornerRadius(sliderBg, 3)
                
                local sliderFill = Create("Frame", {
                    Name = "Fill",
                    Size = UDim2.new(0, 0, 1, 0),
                    Position = UDim2.new(0, 0, 0, 0),
                    BackgroundColor3 = Colors.Accent,
                    BorderSizePixel = 0,
                    Parent = sliderBg,
                })
                ApplyCornerRadius(sliderFill, 3)
                
                local sliderButton = Create("TextButton", {
                    Name = "Button",
                    Size = UDim2.new(0, 14, 0, 14),
                    Position = UDim2.new(0, -7, 0.5, -7),
                    BackgroundColor3 = Colors.Text,
                    Text = "",
                    BorderSizePixel = 0,
                    ZIndex = 15,
                    Parent = sliderBg,
                })
                ApplyCornerRadius(sliderButton, 7)
                
                local value = math.clamp(default, min, max)
                local dragging = false
                
                local function updateSlider()
                    local percentage = (value - min) / (max - min)
                    sliderFill.Size = UDim2.new(percentage, 0, 1, 0)
                    sliderButton.Position = UDim2.new(percentage, -7, 0.5, -7)
                    
                    if precise > 0 then
                        valueLabel.Text = string.format("%." .. precise .. "f", value) .. suffix
                    else
                        valueLabel.Text = tostring(math.floor(value)) .. suffix
                    end
                    
                    if callback then callback(value) end
                end
                
                updateSlider()
                
                sliderButton.MouseButton1Down:Connect(function()
                    dragging = true
                end)
                
                RunService.RenderStepped:Connect(function()
                    if dragging and UserInputService:IsMouseButtonPressed(Enum.UserInputType.MouseButton1) then
                        local mousePos = UserInputService:GetMouseLocation()
                        local sliderPos = sliderBg.AbsolutePosition
                        local sliderSize = sliderBg.AbsoluteSize
                        
                        local relativeX = math.clamp((mousePos.X - sliderPos.X) / sliderSize.X, 0, 1)
                        value = min + (relativeX * (max - min))
                        
                        if precise == 0 then
                            value = math.floor(value)
                        else
                            value = math.floor(value * (10 ^ precise)) / (10 ^ precise)
                        end
                        
                        value = math.clamp(value, min, max)
                        updateSlider()
                    else
                        dragging = false
                    end
                end)
                
                table.insert(groupbox._elements, sliderFrame)
                
                local sliderObj = {}
                function sliderObj:SetValue(newValue)
                    value = math.clamp(newValue, min, max)
                    updateSlider()
                end
                function sliderObj:GetValue()
                    return value
                end
                
                return sliderObj
            end
            
            -- Add Dropdown
            function groupbox:AddDropdown(text, options)
                options = options or {}
                local values = options.Values or {}
                local default = options.Default or values[1]
                local callback = options.Callback
                local showEllipsis = options.ShowEllipsis or false
                
                local dropdownFrame = Create("Frame", {
                    Name = "Dropdown",
                    Size = UDim2.new(1, 0, 0, 50),
                    BackgroundTransparency = 1,
                    LayoutOrder = #groupbox._elements + 1,
                    Parent = contentContainer,
                })
                
                local dropdownLabel = Create("TextLabel", {
                    Name = "Label",
                    Size = UDim2.new(1, -60, 0, 20),
                    Position = UDim2.new(0, 0, 0, 0),
                    BackgroundTransparency = 1,
                    Text = text,
                    TextColor3 = Colors.Text,
                    TextSize = 13,
                    Font = Enum.Font.Gotham,
                    TextXAlignment = Enum.TextXAlignment.Left,
                    Parent = dropdownFrame,
                })
                
                if showEllipsis then
                    local ellipsis = Create("TextButton", {
                        Name = "Ellipsis",
                        Size = UDim2.new(0, 20, 0, 20),
                        Position = UDim2.new(0, -25, 0, 0),
                        BackgroundTransparency = 1,
                        Text = "...",
                        TextColor3 = Colors.TextSecondary,
                        TextSize = 14,
                        Font = Enum.Font.GothamBold,
                        Parent = dropdownLabel,
                    })
                end
                
                local dropdownButton = Create("TextButton", {
                    Name = "Button",
                    Size = UDim2.new(1, 0, 0, 28),
                    Position = UDim2.new(0, 0, 0, 22),
                    BackgroundColor3 = Colors.Tertiary,
                    Text = tostring(default or "Select..."),
                    TextColor3 = Colors.Text,
                    TextSize = 13,
                    Font = Enum.Font.Gotham,
                    TextXAlignment = Enum.TextXAlignment.Left,
                    BorderSizePixel = 0,
                    Parent = dropdownFrame,
                })
                ApplyCornerRadius(dropdownButton, 4)
                
                local dropdownPadding = Create("UIPadding", {
                    PaddingLeft = UDim.new(0, 10),
                    PaddingRight = UDim.new(0, 10),
                    Parent = dropdownButton,
                })
                
                local selectedValue = default
                local open = false
                local listFrame = nil
                
                dropdownButton.MouseButton1Click:Connect(function()
                    open = not open
                    
                    if open then
                        listFrame = Create("ScrollingFrame", {
                            Name = "List",
                            Size = UDim2.new(1, 0, 0, math.min(#values * 30 + 4, 200)),
                            Position = UDim2.new(0, 0, 1, 4),
                            BackgroundColor3 = Colors.Secondary,
                            BorderSizePixel = 0,
                            ScrollBarThickness = 4,
                            ScrollBarImageColor3 = Colors.Accent,
                            CanvasSize = UDim2.new(0, 0, 0, #values * 30),
                            ZIndex = 20,
                            Parent = dropdownFrame,
                        })
                        ApplyCornerRadius(listFrame, 4)
                        CreateStroke(listFrame, Colors.Border, 1, 0.5)
                        
                        local listLayout = Create("UIListLayout", {
                            FillDirection = Enum.FillDirection.Vertical,
                            Padding = UDim.new(0, 2),
                            Parent = listFrame,
                        })
                        
                        local listPadding = Create("UIPadding", {
                            PaddingTop = UDim.new(0, 2),
                            PaddingBottom = UDim.new(0, 2),
                            PaddingLeft = UDim.new(0, 2),
                            PaddingRight = UDim.new(0, 2),
                            Parent = listFrame,
                        })
                        
                        for i, value in ipairs(values) do
                            local optionBtn = Create("TextButton", {
                                Name = tostring(value),
                                Size = UDim2.new(1, -4, 0, 26),
                                BackgroundColor3 = Colors.Tertiary,
                                Text = tostring(value),
                                TextColor3 = Colors.Text,
                                TextSize = 12,
                                Font = Enum.Font.Gotham,
                                TextXAlignment = Enum.TextXAlignment.Left,
                                BorderSizePixel = 0,
                                LayoutOrder = i,
                                Parent = listFrame,
                            })
                            ApplyCornerRadius(optionBtn, 2)
                            
                            local optionPadding = Create("UIPadding", {
                                PaddingLeft = UDim.new(0, 8),
                                Parent = optionBtn,
                            })
                            
                            optionBtn.MouseButton1Click:Connect(function()
                                selectedValue = value
                                dropdownButton.Text = tostring(value)
                                open = false
                                if listFrame then
                                    listFrame:Destroy()
                                    listFrame = nil
                                end
                                if callback then callback(value) end
                            end)
                            
                            optionBtn.MouseEnter:Connect(function()
                                Tween(optionBtn, {BackgroundColor3 = Colors.Accent})
                            end)
                            
                            optionBtn.MouseLeave:Connect(function()
                                Tween(optionBtn, {BackgroundColor3 = Colors.Tertiary})
                            end)
                        end
                    else
                        if listFrame then
                            listFrame:Destroy()
                            listFrame = nil
                        end
                    end
                end)
                
                table.insert(groupbox._elements, dropdownFrame)
                
                local dropdownObj = {}
                function dropdownObj:SetValue(newValue)
                    selectedValue = newValue
                    dropdownButton.Text = tostring(newValue)
                    if callback then callback(newValue) end
                end
                function dropdownObj:GetValue()
                    return selectedValue
                end
                function dropdownObj:SetValues(newValues)
                    values = newValues
                end
                
                return dropdownObj
            end
            
            -- Add Arrow Item (clickable item with arrow)
            function groupbox:AddArrowItem(text, callback)
                local arrowFrame = Create("Frame", {
                    Name = text,
                    Size = UDim2.new(1, 0, 0, 35),
                    BackgroundTransparency = 1,
                    LayoutOrder = #groupbox._elements + 1,
                    Parent = contentContainer,
                })
                
                local arrowLabel = Create("TextLabel", {
                    Name = "Label",
                    Size = UDim2.new(1, -30, 1, 0),
                    Position = UDim2.new(0, 0, 0, 0),
                    BackgroundTransparency = 1,
                    Text = text,
                    TextColor3 = Colors.Text,
                    TextSize = 13,
                    Font = Enum.Font.Gotham,
                    TextXAlignment = Enum.TextXAlignment.Left,
                    Parent = arrowFrame,
                })
                
                local arrowIcon = Create("TextLabel", {
                    Name = "Arrow",
                    Size = UDim2.new(0, 20, 1, 0),
                    Position = UDim2.new(1, -20, 0, 0),
                    BackgroundTransparency = 1,
                    Text = "â†’",
                    TextColor3 = Colors.TextSecondary,
                    TextSize = 16,
                    Font = Enum.Font.GothamBold,
                    Parent = arrowFrame,
                })
                
                local arrowBtn = Create("TextButton", {
                    Name = "Button",
                    Size = UDim2.new(1, 0, 1, 0),
                    Position = UDim2.new(0, 0, 0, 0),
                    BackgroundTransparency = 1,
                    Text = "",
                    BorderSizePixel = 0,
                    ZIndex = 10,
                    Parent = arrowFrame,
                })
                
                arrowBtn.MouseButton1Click:Connect(function()
                    if callback then callback() end
                end)
                
                arrowBtn.MouseEnter:Connect(function()
                    Tween(arrowLabel, {TextColor3 = Colors.Accent})
                    Tween(arrowIcon, {TextColor3 = Colors.Accent})
                end)
                
                arrowBtn.MouseLeave:Connect(function()
                    Tween(arrowLabel, {TextColor3 = Colors.Text})
                    Tween(arrowIcon, {TextColor3 = Colors.TextSecondary})
                end)
                
                table.insert(groupbox._elements, arrowFrame)
                
                local arrowObj = {}
                function arrowObj:SetText(newText)
                    arrowLabel.Text = newText
                end
                
                return arrowObj
            end
            
            table.insert(section._items, groupbox)
            return groupbox
        end
        
        table.insert(window._sections, section)
        return section
    end
    
    -- Set user profile
    function window:SetUserProfile(username, daysLeft, avatarIcon)
        username = username or LocalPlayer.Name
        daysLeft = daysLeft or "0 days left"
        
        local usernameLabel = Create("TextLabel", {
            Name = "Username",
            Size = UDim2.new(1, -50, 0, 20),
            Position = UDim2.new(0, 10, 0, 10),
            BackgroundTransparency = 1,
            Text = username,
            TextColor3 = Colors.Text,
            TextSize = 14,
            Font = Enum.Font.GothamBold,
            TextXAlignment = Enum.TextXAlignment.Left,
            Parent = userProfile,
        })
        
        local daysLabel = Create("TextLabel", {
            Name = "Days",
            Size = UDim2.new(1, -50, 0, 16),
            Position = UDim2.new(0, 10, 0, 30),
            BackgroundTransparency = 1,
            Text = daysLeft,
            TextColor3 = Colors.TextSecondary,
            TextSize = 12,
            Font = Enum.Font.Gotham,
            TextXAlignment = Enum.TextXAlignment.Left,
            Parent = userProfile,
        })
        
        local avatar = Create("Frame", {
            Name = "Avatar",
            Size = UDim2.new(0, 30, 0, 30),
            Position = UDim2.new(1, -40, 0, 10),
            BackgroundColor3 = Colors.Accent,
            BorderSizePixel = 0,
            Parent = userProfile,
        })
        ApplyCornerRadius(avatar, 15)
        
        if avatarIcon then
            local iconLabel = Create("TextLabel", {
                Name = "Icon",
                Size = UDim2.new(1, 0, 1, 0),
                Position = UDim2.new(0, 0, 0, 0),
                BackgroundTransparency = 1,
                Text = avatarIcon,
                TextColor3 = Colors.Text,
                TextSize = 16,
                Font = Enum.Font.Gotham,
                Parent = avatar,
            })
        end
    end
    
    window._screenGui = screenGui
    window._mainContainer = mainContainer
    window._sidebar = sidebar
    window._leftColumn = leftColumn
    window._rightColumn = rightColumn
    
    -- Set default user profile
    window:SetUserProfile(LocalPlayer.Name, "107 days left", "ðŸ‘¤")
    
    table.insert(NeverloseUI._windows or {}, window)
    if not NeverloseUI._windows then
        NeverloseUI._windows = {}
    end
    
    return window
end

-- Initialize
NeverloseUI._windows = {}

return NeverloseUI

