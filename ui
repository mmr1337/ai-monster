-- Custom UI Library for Roblox
-- Author: Custom
-- Version: 1.0.0

local Players = game:GetService("Players")
local TweenService = game:GetService("TweenService")
local UserInputService = game:GetService("UserInputService")
local RunService = game:GetService("RunService")

local LocalPlayer = Players.LocalPlayer
local PlayerGui = LocalPlayer:WaitForChild("PlayerGui")

local CustomUILib = {}
CustomUILib.__index = CustomUILib

-- Color schemes
local Themes = {
    Default = {
        Background = Color3.fromRGB(25, 25, 25),
        Secondary = Color3.fromRGB(30, 30, 30),
        Accent = Color3.fromRGB(0, 162, 255),
        Text = Color3.fromRGB(255, 255, 255),
        TextSecondary = Color3.fromRGB(200, 200, 200),
        Border = Color3.fromRGB(60, 60, 60),
    },
    Dark = {
        Background = Color3.fromRGB(15, 15, 15),
        Secondary = Color3.fromRGB(20, 20, 20),
        Accent = Color3.fromRGB(100, 149, 237),
        Text = Color3.fromRGB(255, 255, 255),
        TextSecondary = Color3.fromRGB(180, 180, 180),
        Border = Color3.fromRGB(50, 50, 50),
    },
    Light = {
        Background = Color3.fromRGB(245, 245, 245),
        Secondary = Color3.fromRGB(255, 255, 255),
        Accent = Color3.fromRGB(0, 120, 215),
        Text = Color3.fromRGB(30, 30, 30),
        TextSecondary = Color3.fromRGB(100, 100, 100),
        Border = Color3.fromRGB(200, 200, 200),
    },
}

local currentTheme = Themes.Default

-- Utility functions
local function Create(class, props)
    local instance = Instance.new(class)
    for prop, value in pairs(props or {}) do
        if prop ~= "Parent" and prop ~= "Children" then
            instance[prop] = value
        end
    end
    if props and props.Parent then
        instance.Parent = props.Parent
    end
    if props and props.Children then
        for _, child in ipairs(props.Children) do
            child.Parent = instance
        end
    end
    return instance
end

local function Tween(obj, props, duration, style, direction)
    local tweenInfo = TweenInfo.new(
        duration or 0.2,
        style or Enum.EasingStyle.Quad,
        direction or Enum.EasingDirection.Out
    )
    local tween = TweenService:Create(obj, tweenInfo, props)
    tween:Play()
    return tween
end

-- Rounded corner function
local function ApplyCornerRadius(obj, radius)
    local corner = Instance.new("UICorner")
    corner.CornerRadius = UDim.new(0, radius or 4)
    corner.Parent = obj
    return corner
end

-- Window
function CustomUILib:Window(title, icon)
    title = title or "Custom UI"
    
    local window = {}
    window._elements = {}
    window._tabs = {}
    
    -- Main ScreenGui
    local screenGui = Create("ScreenGui", {
        Name = title .. "_UI",
        ZIndexBehavior = Enum.ZIndexBehavior.Sibling,
        ResetOnSpawn = false,
        Parent = PlayerGui,
    })
    
    -- Main frame
    local mainFrame = Create("Frame", {
        Name = "Main",
        Size = UDim2.new(0, 500, 0, 400),
        Position = UDim2.new(0.5, -250, 0.5, -200),
        BackgroundColor3 = currentTheme.Background,
        BorderSizePixel = 0,
        Parent = screenGui,
        Children = {
            Create("UIStroke", {
                Color = currentTheme.Border,
                Thickness = 1,
                Transparency = 0.5,
            })
        }
    })
    ApplyCornerRadius(mainFrame, 8)
    
    -- Title bar
    local titleBar = Create("Frame", {
        Name = "TitleBar",
        Size = UDim2.new(1, 0, 0, 40),
        Position = UDim2.new(0, 0, 0, 0),
        BackgroundColor3 = currentTheme.Secondary,
        BorderSizePixel = 0,
        Parent = mainFrame,
    })
    ApplyCornerRadius(titleBar, 8)
    
    -- Title label
    local titleLabel = Create("TextLabel", {
        Name = "Title",
        Size = UDim2.new(1, -100, 1, 0),
        Position = UDim2.new(0, 10, 0, 0),
        BackgroundTransparency = 1,
        Text = title,
        TextColor3 = currentTheme.Text,
        TextSize = 16,
        Font = Enum.Font.GothamBold,
        TextXAlignment = Enum.TextXAlignment.Left,
        Parent = titleBar,
    })
    
    -- Close button
    local closeBtn = Create("TextButton", {
        Name = "Close",
        Size = UDim2.new(0, 30, 0, 30),
        Position = UDim2.new(1, -35, 0, 5),
        BackgroundColor3 = Color3.fromRGB(255, 80, 80),
        Text = "Ã—",
        TextColor3 = Color3.fromRGB(255, 255, 255),
        TextSize = 20,
        Font = Enum.Font.GothamBold,
        BorderSizePixel = 0,
        Parent = titleBar,
    })
    ApplyCornerRadius(closeBtn, 4)
    
    closeBtn.MouseButton1Click:Connect(function()
        screenGui:Destroy()
    end)
    
    closeBtn.MouseEnter:Connect(function()
        Tween(closeBtn, {BackgroundColor3 = Color3.fromRGB(255, 100, 100)})
    end)
    
    closeBtn.MouseLeave:Connect(function()
        Tween(closeBtn, {BackgroundColor3 = Color3.fromRGB(255, 80, 80)})
    end)
    
    -- Tabs container
    local tabsContainer = Create("Frame", {
        Name = "Tabs",
        Size = UDim2.new(1, -20, 0, 40),
        Position = UDim2.new(0, 10, 0, 45),
        BackgroundTransparency = 1,
        Parent = mainFrame,
    })
    
    -- Content frame
    local contentFrame = Create("Frame", {
        Name = "Content",
        Size = UDim2.new(1, -20, 1, -90),
        Position = UDim2.new(0, 10, 0, 90),
        BackgroundTransparency = 1,
        ClipsDescendants = true,
        Parent = mainFrame,
    })
    
    -- Make window draggable
    local dragging = false
    local dragInput = nil
    local dragStart = nil
    local startPos = nil
    
    titleBar.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 then
            dragging = true
            dragStart = input.Position
            startPos = mainFrame.Position
            
            input.Changed:Connect(function()
                if input.UserInputState == Enum.UserInputState.End then
                    dragging = false
                end
            end)
        end
    end)
    
    titleBar.InputChanged:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseMovement then
            dragInput = input
        end
    end)
    
    UserInputService.InputChanged:Connect(function(input)
        if input == dragInput and dragging then
            local delta = input.Position - dragStart
            mainFrame.Position = UDim2.new(
                startPos.X.Scale,
                startPos.X.Offset + delta.X,
                startPos.Y.Scale,
                startPos.Y.Offset + delta.Y
            )
        end
    end)
    
    window._screenGui = screenGui
    window._mainFrame = mainFrame
    window._tabsContainer = tabsContainer
    window._contentFrame = contentFrame
    
    function window:Tab(name, icon)
        icon = icon or "âš™"
        
        local tab = {}
        tab._elements = {}
        
        -- Tab button
        local tabBtn = Create("TextButton", {
            Name = name .. "_Tab",
            Size = UDim2.new(0, 100, 1, 0),
            Position = UDim2.new(0, #window._tabs * 105, 0, 0),
            BackgroundColor3 = currentTheme.Secondary,
            Text = icon .. " " .. name,
            TextColor3 = currentTheme.TextSecondary,
            TextSize = 13,
            Font = Enum.Font.Gotham,
            BorderSizePixel = 0,
            Parent = tabsContainer,
        })
        ApplyCornerRadius(tabBtn, 4)
        
        -- Tab content
        local tabContent = Create("ScrollingFrame", {
            Name = name .. "_Content",
            Size = UDim2.new(1, 0, 1, 0),
            Position = UDim2.new(0, 0, 0, 0),
            BackgroundTransparency = 1,
            BorderSizePixel = 0,
            ScrollBarThickness = 4,
            ScrollBarImageColor3 = currentTheme.Accent,
            CanvasSize = UDim2.new(0, 0, 0, 0),
            Visible = #window._tabs == 0,
            Parent = contentFrame,
        })
        
        local layout = Create("UIListLayout", {
            FillDirection = Enum.FillDirection.Vertical,
            Padding = UDim.new(0, 10),
            SortOrder = Enum.SortOrder.LayoutOrder,
            Parent = tabContent,
        })
        
        local padding = Create("UIPadding", {
            PaddingTop = UDim.new(0, 10),
            PaddingBottom = UDim.new(0, 10),
            PaddingLeft = UDim.new(0, 10),
            PaddingRight = UDim.new(0, 10),
            Parent = tabContent,
        })
        
        layout:GetPropertyChangedSignal("AbsoluteContentSize"):Connect(function()
            tabContent.CanvasSize = UDim2.new(0, 0, 0, layout.AbsoluteContentSize.Y + 20)
        end)
        
        -- Tab button interactions
        tabBtn.MouseButton1Click:Connect(function()
            for _, otherTab in ipairs(window._tabs) do
                if otherTab._content then
                    otherTab._content.Visible = false
                end
                if otherTab._button then
                    Tween(otherTab._button, {
                        BackgroundColor3 = currentTheme.Secondary,
                        TextColor3 = currentTheme.TextSecondary,
                    })
                end
            end
            tabContent.Visible = true
            Tween(tabBtn, {
                BackgroundColor3 = currentTheme.Accent,
                TextColor3 = Color3.fromRGB(255, 255, 255),
            })
        end)
        
        if #window._tabs == 0 then
            Tween(tabBtn, {
                BackgroundColor3 = currentTheme.Accent,
                TextColor3 = Color3.fromRGB(255, 255, 255),
            })
        end
        
        tabBtn.MouseEnter:Connect(function()
            if not tabContent.Visible then
                Tween(tabBtn, {BackgroundColor3 = Color3.fromRGB(
                    math.min(currentTheme.Secondary.R * 255 + 10, 255) / 255,
                    math.min(currentTheme.Secondary.G * 255 + 10, 255) / 255,
                    math.min(currentTheme.Secondary.B * 255 + 10, 255) / 255
                )})
            end
        end)
        
        tabBtn.MouseLeave:Connect(function()
            if not tabContent.Visible then
                Tween(tabBtn, {BackgroundColor3 = currentTheme.Secondary})
            end
        end)
        
        tab._button = tabBtn
        tab._content = tabContent
        
        function tab:AddGroupbox(name, icon)
            icon = icon or "ðŸ“¦"
            name = name or "Group"
            
            local groupbox = {}
            
            local groupFrame = Create("Frame", {
                Name = name,
                Size = UDim2.new(0, 220, 0, 0),
                BackgroundColor3 = currentTheme.Secondary,
                BorderSizePixel = 0,
                Parent = tabContent,
                LayoutOrder = #tab._elements + 1,
                Children = {
                    Create("UIStroke", {
                        Color = currentTheme.Border,
                        Thickness = 1,
                        Transparency = 0.7,
                    })
                }
            })
            ApplyCornerRadius(groupFrame, 6)
            
            local titleFrame = Create("Frame", {
                Name = "Title",
                Size = UDim2.new(1, -10, 0, 30),
                Position = UDim2.new(0, 5, 0, 5),
                BackgroundTransparency = 1,
                Parent = groupFrame,
            })
            
            local titleLabel = Create("TextLabel", {
                Name = "Label",
                Size = UDim2.new(1, 0, 1, 0),
                Position = UDim2.new(0, 0, 0, 0),
                BackgroundTransparency = 1,
                Text = icon .. " " .. name,
                TextColor3 = currentTheme.Text,
                TextSize = 14,
                Font = Enum.Font.GothamBold,
                TextXAlignment = Enum.TextXAlignment.Left,
                Parent = titleFrame,
            })
            
            local contentContainer = Create("Frame", {
                Name = "Content",
                Size = UDim2.new(1, -10, 0, 0),
                Position = UDim2.new(0, 5, 0, 40),
                BackgroundTransparency = 1,
                Parent = groupFrame,
            })
            
            local contentLayout = Create("UIListLayout", {
                FillDirection = Enum.FillDirection.Vertical,
                Padding = UDim.new(0, 8),
                SortOrder = Enum.SortOrder.LayoutOrder,
                Parent = contentContainer,
            })
            
            local contentPadding = Create("UIPadding", {
                PaddingTop = UDim.new(0, 5),
                PaddingBottom = UDim.new(0, 5),
                PaddingLeft = UDim.new(0, 5),
                PaddingRight = UDim.new(0, 5),
                Parent = contentContainer,
            })
            
            contentLayout:GetPropertyChangedSignal("AbsoluteContentSize"):Connect(function()
                groupFrame.Size = UDim2.new(0, 220, 0, contentLayout.AbsoluteContentSize.Y + 50)
            end)
            
            groupbox._frame = groupFrame
            groupbox._content = contentContainer
            groupbox._elements = {}
            
            function groupbox:AddLabel(text, bold)
                bold = bold or false
                
                local label = Create("TextLabel", {
                    Name = "Label",
                    Size = UDim2.new(1, 0, 0, 20),
                    BackgroundTransparency = 1,
                    Text = text or "Label",
                    TextColor3 = currentTheme.TextSecondary,
                    TextSize = 13,
                    Font = bold and Enum.Font.GothamBold or Enum.Font.Gotham,
                    TextXAlignment = Enum.TextXAlignment.Left,
                    TextWrapped = true,
                    Parent = contentContainer,
                    LayoutOrder = #groupbox._elements + 1,
                })
                
                label:GetPropertyChangedSignal("TextBounds"):Connect(function()
                    label.Size = UDim2.new(1, 0, 0, label.TextBounds.Y)
                end)
                
                table.insert(groupbox._elements, label)
                
                local labelObj = {}
                
                function labelObj:SetText(newText)
                    label.Text = newText
                end
                
                return labelObj
            end
            
            function groupbox:AddButton(text, callback)
                text = text or "Button"
                
                local button = Create("TextButton", {
                    Name = "Button",
                    Size = UDim2.new(1, 0, 0, 32),
                    BackgroundColor3 = currentTheme.Accent,
                    Text = text,
                    TextColor3 = Color3.fromRGB(255, 255, 255),
                    TextSize = 13,
                    Font = Enum.Font.Gotham,
                    BorderSizePixel = 0,
                    Parent = contentContainer,
                    LayoutOrder = #groupbox._elements + 1,
                })
                ApplyCornerRadius(button, 4)
                
                if callback then
                    button.MouseButton1Click:Connect(callback)
                end
                
                button.MouseEnter:Connect(function()
                    Tween(button, {BackgroundColor3 = Color3.fromRGB(
                        math.min(currentTheme.Accent.R * 255 + 20, 255) / 255,
                        math.min(currentTheme.Accent.G * 255 + 20, 255) / 255,
                        math.min(currentTheme.Accent.B * 255 + 20, 255) / 255
                    )})
                end)
                
                button.MouseLeave:Connect(function()
                    Tween(button, {BackgroundColor3 = currentTheme.Accent})
                end)
                
                table.insert(groupbox._elements, button)
                
                local buttonObj = {}
                
                function buttonObj:SetText(newText)
                    button.Text = newText
                end
                
                return buttonObj
            end
            
            function groupbox:AddToggle(text, callback)
                text = text or "Toggle"
                
                local toggleFrame = Create("Frame", {
                    Name = "Toggle",
                    Size = UDim2.new(1, 0, 0, 32),
                    BackgroundTransparency = 1,
                    Parent = contentContainer,
                    LayoutOrder = #groupbox._elements + 1,
                })
                
                local toggleLabel = Create("TextLabel", {
                    Name = "Label",
                    Size = UDim2.new(1, -40, 1, 0),
                    Position = UDim2.new(0, 0, 0, 0),
                    BackgroundTransparency = 1,
                    Text = text,
                    TextColor3 = currentTheme.Text,
                    TextSize = 13,
                    Font = Enum.Font.Gotham,
                    TextXAlignment = Enum.TextXAlignment.Left,
                    Parent = toggleFrame,
                })
                
                local toggleBg = Create("Frame", {
                    Name = "Background",
                    Size = UDim2.new(0, 36, 0, 20),
                    Position = UDim2.new(1, -36, 0.5, -10),
                    BackgroundColor3 = currentTheme.Border,
                    BorderSizePixel = 0,
                    Parent = toggleFrame,
                })
                ApplyCornerRadius(toggleBg, 10)
                
                local toggleSlider = Create("Frame", {
                    Name = "Slider",
                    Size = UDim2.new(0, 16, 0, 16),
                    Position = UDim2.new(0, 2, 0.5, -8),
                    BackgroundColor3 = Color3.fromRGB(255, 255, 255),
                    BorderSizePixel = 0,
                    Parent = toggleBg,
                })
                ApplyCornerRadius(toggleSlider, 8)
                
                local state = false
                
                local function updateToggle()
                    if state then
                        Tween(toggleSlider, {Position = UDim2.new(1, -18, 0.5, -8)})
                        Tween(toggleBg, {BackgroundColor3 = currentTheme.Accent})
                    else
                        Tween(toggleSlider, {Position = UDim2.new(0, 2, 0.5, -8)})
                        Tween(toggleBg, {BackgroundColor3 = currentTheme.Border})
                    end
                    if callback then
                        callback(state)
                    end
                end
                
                toggleFrame.MouseButton1Click:Connect(function()
                    state = not state
                    updateToggle()
                end)
                
                table.insert(groupbox._elements, toggleFrame)
                
                local toggleObj = {}
                
                function toggleObj:SetValue(value)
                    state = value
                    updateToggle()
                end
                
                function toggleObj:GetValue()
                    return state
                end
                
                return toggleObj
            end
            
            function groupbox:AddDropdown(text, options)
                text = text or "Dropdown"
                options = options or {}
                options.Values = options.Values or {}
                options.Default = options.Default or options.Values[1]
                options.Multi = options.Multi or false
                
                local dropdownFrame = Create("Frame", {
                    Name = "Dropdown",
                    Size = UDim2.new(1, 0, 0, 32),
                    BackgroundTransparency = 1,
                    Parent = contentContainer,
                    LayoutOrder = #groupbox._elements + 1,
                })
                
                local dropdownLabel = Create("TextLabel", {
                    Name = "Label",
                    Size = UDim2.new(1, 0, 0, 16),
                    Position = UDim2.new(0, 0, 0, 0),
                    BackgroundTransparency = 1,
                    Text = text,
                    TextColor3 = currentTheme.TextSecondary,
                    TextSize = 12,
                    Font = Enum.Font.Gotham,
                    TextXAlignment = Enum.TextXAlignment.Left,
                    Parent = dropdownFrame,
                })
                
                local dropdownButton = Create("TextButton", {
                    Name = "Button",
                    Size = UDim2.new(1, 0, 0, 28),
                    Position = UDim2.new(0, 0, 0, 16),
                    BackgroundColor3 = currentTheme.Secondary,
                    Text = options.Default or "Select...",
                    TextColor3 = currentTheme.Text,
                    TextSize = 13,
                    Font = Enum.Font.Gotham,
                    TextXAlignment = Enum.TextXAlignment.Left,
                    BorderSizePixel = 0,
                    Parent = dropdownFrame,
                })
                ApplyCornerRadius(dropdownButton, 4)
                
                local dropdownPadding = Create("UIPadding", {
                    PaddingLeft = UDim.new(0, 8),
                    PaddingRight = UDim.new(0, 8),
                    Parent = dropdownButton,
                })
                
                local dropdownArrow = Create("TextLabel", {
                    Name = "Arrow",
                    Size = UDim2.new(0, 20, 1, 0),
                    Position = UDim2.new(1, -20, 0, 0),
                    BackgroundTransparency = 1,
                    Text = "â–¼",
                    TextColor3 = currentTheme.TextSecondary,
                    TextSize = 10,
                    Font = Enum.Font.Gotham,
                    Parent = dropdownButton,
                })
                
                dropdownFrame.Size = UDim2.new(1, 0, 0, 44)
                
                local open = false
                local selectedValue = options.Default
                local listFrame = nil
                
                local function toggleList()
                    open = not open
                    
                    if open then
                        listFrame = Create("ScrollingFrame", {
                            Name = "List",
                            Size = UDim2.new(1, 0, 0, math.min(#options.Values * 28 + 4, 200)),
                            Position = UDim2.new(0, 0, 1, 4),
                            BackgroundColor3 = currentTheme.Background,
                            BorderSizePixel = 0,
                            ScrollBarThickness = 4,
                            ScrollBarImageColor3 = currentTheme.Accent,
                            CanvasSize = UDim2.new(0, 0, 0, #options.Values * 28),
                            ZIndex = 10,
                            Parent = dropdownFrame,
                        })
                        ApplyCornerRadius(listFrame, 4)
                        
                        local listLayout = Create("UIListLayout", {
                            FillDirection = Enum.FillDirection.Vertical,
                            Padding = UDim.new(0, 2),
                            Parent = listFrame,
                        })
                        
                        local listPadding = Create("UIPadding", {
                            PaddingTop = UDim.new(0, 2),
                            PaddingBottom = UDim.new(0, 2),
                            PaddingLeft = UDim.new(0, 2),
                            PaddingRight = UDim.new(0, 2),
                            Parent = listFrame,
                        })
                        
                        for i, value in ipairs(options.Values) do
                            local optionBtn = Create("TextButton", {
                                Name = value,
                                Size = UDim2.new(1, -4, 0, 24),
                                BackgroundColor3 = currentTheme.Secondary,
                                Text = tostring(value),
                                TextColor3 = currentTheme.Text,
                                TextSize = 12,
                                Font = Enum.Font.Gotham,
                                TextXAlignment = Enum.TextXAlignment.Left,
                                BorderSizePixel = 0,
                                Parent = listFrame,
                                LayoutOrder = i,
                            })
                            ApplyCornerRadius(optionBtn, 2)
                            
                            local optionPadding = Create("UIPadding", {
                                PaddingLeft = UDim.new(0, 6),
                                Parent = optionBtn,
                            })
                            
                            optionBtn.MouseButton1Click:Connect(function()
                                selectedValue = value
                                dropdownButton.Text = tostring(value)
                                if options.Callback then
                                    options.Callback(value)
                                end
                                open = false
                                if listFrame then
                                    listFrame:Destroy()
                                    listFrame = nil
                                end
                            end)
                            
                            optionBtn.MouseEnter:Connect(function()
                                Tween(optionBtn, {BackgroundColor3 = currentTheme.Accent})
                            end)
                            
                            optionBtn.MouseLeave:Connect(function()
                                Tween(optionBtn, {BackgroundColor3 = currentTheme.Secondary})
                            end)
                        end
                    else
                        if listFrame then
                            listFrame:Destroy()
                            listFrame = nil
                        end
                    end
                end
                
                dropdownButton.MouseButton1Click:Connect(toggleList)
                
                -- Close dropdown when clicking outside
                UserInputService.InputBegan:Connect(function(input)
                    if input.UserInputType == Enum.UserInputType.MouseButton1 and open then
                        local mousePos = UserInputService:GetMouseLocation()
                        if listFrame then
                            local framePos = listFrame.AbsolutePosition
                            local frameSize = listFrame.AbsoluteSize
                            if not (mousePos.X >= framePos.X and mousePos.X <= framePos.X + frameSize.X and
                                   mousePos.Y >= framePos.Y and mousePos.Y <= framePos.Y + frameSize.Y) then
                                open = false
                                listFrame:Destroy()
                                listFrame = nil
                            end
                        end
                    end
                end)
                
                table.insert(groupbox._elements, dropdownFrame)
                
                local dropdownObj = {}
                
                function dropdownObj:SetValue(value)
                    selectedValue = value
                    dropdownButton.Text = tostring(value)
                    if options.Callback then
                        options.Callback(value)
                    end
                end
                
                function dropdownObj:GetValue()
                    return selectedValue
                end
                
                function dropdownObj:SetValues(values)
                    options.Values = values
                end
                
                return dropdownObj
            end
            
            function groupbox:AddSlider(text, options)
                text = text or "Slider"
                options = options or {}
                options.Min = options.Min or 0
                options.Max = options.Max or 100
                options.Default = options.Default or options.Min
                options.Precise = options.Precise or 0
                
                local sliderFrame = Create("Frame", {
                    Name = "Slider",
                    Size = UDim2.new(1, 0, 0, 44),
                    BackgroundTransparency = 1,
                    Parent = contentContainer,
                    LayoutOrder = #groupbox._elements + 1,
                })
                
                local sliderLabel = Create("TextLabel", {
                    Name = "Label",
                    Size = UDim2.new(1, 0, 0, 16),
                    Position = UDim2.new(0, 0, 0, 0),
                    BackgroundTransparency = 1,
                    Text = text,
                    TextColor3 = currentTheme.TextSecondary,
                    TextSize = 12,
                    Font = Enum.Font.Gotham,
                    TextXAlignment = Enum.TextXAlignment.Left,
                    Parent = sliderFrame,
                })
                
                local valueLabel = Create("TextLabel", {
                    Name = "Value",
                    Size = UDim2.new(0, 50, 0, 16),
                    Position = UDim2.new(1, -50, 0, 0),
                    BackgroundTransparency = 1,
                    Text = tostring(options.Default),
                    TextColor3 = currentTheme.Text,
                    TextSize = 12,
                    Font = Enum.Font.GothamBold,
                    TextXAlignment = Enum.TextXAlignment.Right,
                    Parent = sliderFrame,
                })
                
                local sliderBg = Create("Frame", {
                    Name = "Background",
                    Size = UDim2.new(1, 0, 0, 6),
                    Position = UDim2.new(0, 0, 0, 22),
                    BackgroundColor3 = currentTheme.Border,
                    BorderSizePixel = 0,
                    Parent = sliderFrame,
                })
                ApplyCornerRadius(sliderBg, 3)
                
                local sliderFill = Create("Frame", {
                    Name = "Fill",
                    Size = UDim2.new(0, 0, 1, 0),
                    Position = UDim2.new(0, 0, 0, 0),
                    BackgroundColor3 = currentTheme.Accent,
                    BorderSizePixel = 0,
                    Parent = sliderBg,
                })
                ApplyCornerRadius(sliderFill, 3)
                
                local sliderButton = Create("TextButton", {
                    Name = "Button",
                    Size = UDim2.new(0, 14, 0, 14),
                    Position = UDim2.new(0, -7, 0.5, -7),
                    BackgroundColor3 = Color3.fromRGB(255, 255, 255),
                    Text = "",
                    BorderSizePixel = 0,
                    Parent = sliderBg,
                    ZIndex = 2,
                })
                ApplyCornerRadius(sliderButton, 7)
                
                local sliderStroke = Create("UIStroke", {
                    Color = currentTheme.Accent,
                    Thickness = 2,
                    Parent = sliderButton,
                })
                
                local value = math.clamp(options.Default, options.Min, options.Max)
                local dragging = false
                
                local function updateSlider()
                    local percentage = (value - options.Min) / (options.Max - options.Min)
                    sliderFill.Size = UDim2.new(percentage, 0, 1, 0)
                    sliderButton.Position = UDim2.new(percentage, -7, 0.5, -7)
                    
                    if options.Precise > 0 then
                        valueLabel.Text = string.format("%." .. options.Precise .. "f", value)
                    else
                        valueLabel.Text = tostring(math.floor(value))
                    end
                    
                    if options.Callback then
                        options.Callback(value)
                    end
                end
                
                updateSlider()
                
                sliderButton.MouseButton1Down:Connect(function()
                    dragging = true
                end)
                
                UserInputService.InputChanged:Connect(function(input)
                    if dragging and input.UserInputType == Enum.UserInputType.MouseMovement then
                        local mousePos = UserInputService:GetMouseLocation()
                        local sliderPos = sliderBg.AbsolutePosition
                        local sliderSize = sliderBg.AbsoluteSize
                        
                        local relativeX = math.clamp((mousePos.X - sliderPos.X) / sliderSize.X, 0, 1)
                        value = options.Min + (relativeX * (options.Max - options.Min))
                        
                        if options.Precise == 0 then
                            value = math.floor(value)
                        else
                            value = math.floor(value * (10 ^ options.Precise)) / (10 ^ options.Precise)
                        end
                        
                        value = math.clamp(value, options.Min, options.Max)
                        updateSlider()
                    end
                end)
                
                UserInputService.InputEnded:Connect(function(input)
                    if input.UserInputType == Enum.UserInputType.MouseButton1 then
                        dragging = false
                    end
                end)
                
                table.insert(groupbox._elements, sliderFrame)
                
                local sliderObj = {}
                
                function sliderObj:SetValue(newValue)
                    value = math.clamp(newValue, options.Min, options.Max)
                    updateSlider()
                end
                
                function sliderObj:GetValue()
                    return value
                end
                
                return sliderObj
            end
            
            function groupbox:AddTextbox(text, placeholder, callback)
                text = text or "Textbox"
                placeholder = placeholder or "Enter text..."
                
                local textboxFrame = Create("Frame", {
                    Name = "Textbox",
                    Size = UDim2.new(1, 0, 0, 44),
                    BackgroundTransparency = 1,
                    Parent = contentContainer,
                    LayoutOrder = #groupbox._elements + 1,
                })
                
                local textboxLabel = Create("TextLabel", {
                    Name = "Label",
                    Size = UDim2.new(1, 0, 0, 16),
                    Position = UDim2.new(0, 0, 0, 0),
                    BackgroundTransparency = 1,
                    Text = text,
                    TextColor3 = currentTheme.TextSecondary,
                    TextSize = 12,
                    Font = Enum.Font.Gotham,
                    TextXAlignment = Enum.TextXAlignment.Left,
                    Parent = textboxFrame,
                })
                
                local textboxInput = Create("TextBox", {
                    Name = "Input",
                    Size = UDim2.new(1, 0, 0, 28),
                    Position = UDim2.new(0, 0, 0, 16),
                    BackgroundColor3 = currentTheme.Secondary,
                    Text = "",
                    PlaceholderText = placeholder,
                    TextColor3 = currentTheme.Text,
                    PlaceholderColor3 = currentTheme.TextSecondary,
                    TextSize = 13,
                    Font = Enum.Font.Gotham,
                    TextXAlignment = Enum.TextXAlignment.Left,
                    ClearTextOnFocus = false,
                    BorderSizePixel = 0,
                    Parent = textboxFrame,
                })
                ApplyCornerRadius(textboxInput, 4)
                
                local textboxPadding = Create("UIPadding", {
                    PaddingLeft = UDim.new(0, 8),
                    PaddingRight = UDim.new(0, 8),
                    Parent = textboxInput,
                })
                
                textboxInput.Focused:Connect(function()
                    Tween(textboxInput, {BackgroundColor3 = Color3.fromRGB(
                        math.min(currentTheme.Secondary.R * 255 + 15, 255) / 255,
                        math.min(currentTheme.Secondary.G * 255 + 15, 255) / 255,
                        math.min(currentTheme.Secondary.B * 255 + 15, 255) / 255
                    )})
                end)
                
                textboxInput.FocusLost:Connect(function(enterPressed)
                    Tween(textboxInput, {BackgroundColor3 = currentTheme.Secondary})
                    if callback and enterPressed then
                        callback(textboxInput.Text)
                    end
                end)
                
                table.insert(groupbox._elements, textboxFrame)
                
                local textboxObj = {}
                
                function textboxObj:SetText(newText)
                    textboxInput.Text = newText
                end
                
                function textboxObj:GetText()
                    return textboxInput.Text
                end
                
                return textboxObj
            end
            
            table.insert(tab._elements, groupbox)
            return groupbox
        end
        
        table.insert(window._tabs, tab)
        table.insert(window._elements, tab)
        return tab
    end
    
    -- Notification system
    function window:Notify(message, duration)
        duration = duration or 3
        
        local notification = Create("Frame", {
            Name = "Notification",
            Size = UDim2.new(0, 300, 0, 60),
            Position = UDim2.new(1, -320, 0, 10),
            BackgroundColor3 = currentTheme.Background,
            BorderSizePixel = 0,
            Parent = screenGui,
            ZIndex = 100,
            Children = {
                Create("UIStroke", {
                    Color = currentTheme.Border,
                    Thickness = 2,
                })
            }
        })
        ApplyCornerRadius(notification, 6)
        
        local label = Create("TextLabel", {
            Name = "Message",
            Size = UDim2.new(1, -20, 1, -10),
            Position = UDim2.new(0, 10, 0, 5),
            BackgroundTransparency = 1,
            Text = message,
            TextColor3 = currentTheme.Text,
            TextSize = 14,
            Font = Enum.Font.Gotham,
            TextWrapped = true,
            TextXAlignment = Enum.TextXAlignment.Left,
            Parent = notification,
        })
        
        notification.Size = UDim2.new(0, 300, 0, label.TextBounds.Y + 10)
        
        Tween(notification, {Position = UDim2.new(1, -320, 0, 10)}, 0.3)
        
        task.wait(duration)
        
        Tween(notification, {Position = UDim2.new(1, 20, 0, 10)}, 0.3)
        task.wait(0.3)
        notification:Destroy()
    end
    
    table.insert(CustomUILib._windows, window)
    return window
end

-- Initialize
CustomUILib._windows = {}

-- Set theme
function CustomUILib:SetTheme(themeName)
    if Themes[themeName] then
        currentTheme = Themes[themeName]
    end
end

-- Add custom theme
function CustomUILib:AddTheme(name, theme)
    Themes[name] = theme
end

return CustomUILib

